# Coze API é…ç½®æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [é…ç½®æ­¥éª¤](#é…ç½®æ­¥éª¤)
3. [API ç«¯ç‚¹è¯´æ˜](#api-ç«¯ç‚¹è¯´æ˜)
4. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
5. [ä»£ç†é…ç½®](#ä»£ç†é…ç½®)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [é”™è¯¯æ’æŸ¥](#é”™è¯¯æ’æŸ¥)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å– API Token

1. ç™»å½• [Coze å¼€æ”¾å¹³å°](https://www.coze.cn/open)
2. è¿›å…¥ **ä¸ªäººä¸­å¿ƒ** â†’ **API å¯†é’¥**
3. åˆ›å»ºæ–°çš„ API Token æˆ–ä½¿ç”¨ç°æœ‰çš„ Token
4. **é‡è¦**ï¼šToken æœ€é•¿æœ‰æ•ˆæœŸä¸º 30 å¤©ï¼Œè¯·å¦¥å–„ä¿ç®¡

### 2. è·å– Bot ID

1. åœ¨ Coze å¹³å°åˆ›å»ºæˆ–é€‰æ‹©ä¸€ä¸ª Bot
2. åœ¨ Bot è¯¦æƒ…é¡µé¢çš„ URL ä¸­æ‰¾åˆ° `bot_id` å‚æ•°
3. æˆ–è€…åœ¨ Bot è®¾ç½®é¡µé¢æŸ¥çœ‹ Bot ID

### 3. é…ç½®åˆ°é¡¹ç›®ä¸­

æ‰“å¼€ `src/utils/cozeApi.js` æ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹é…ç½®ï¼š

```javascript
const COZE_API_TOKEN = 'ä½ çš„API_TOKEN';  // ğŸ‘ˆ åœ¨è¿™é‡Œå¡«å†™ä½ çš„ Token
const COZE_BOT_ID = 'ä½ çš„BOT_ID';        // ğŸ‘ˆ åœ¨è¿™é‡Œå¡«å†™ä½ çš„ Bot ID
```

---

## âš™ï¸ é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘æ–‡ä»¶ï¼š`src/utils/cozeApi.js`

æ‰¾åˆ°é…ç½®åŒºåŸŸï¼ˆæ–‡ä»¶å¼€å¤´ç¬¬ 11-12 è¡Œï¼‰ï¼š

```javascript
// ==================== é…ç½®åŒºåŸŸ - è¯·åœ¨è¿™é‡Œå¡«å†™ä½ çš„ä¿¡æ¯ ====================
const COZE_API_TOKEN = 'ä½ çš„API_TOKEN'; // è¯·æ›¿æ¢ä¸ºä½ çš„ Coze API Token
const COZE_BOT_ID = 'ä½ çš„BOT_ID'; // è¯·æ›¿æ¢ä¸ºä½ çš„ Bot ID
```

**ç¤ºä¾‹ï¼š**

```javascript
const COZE_API_TOKEN = 'pat_MB1vzZ6uS1jGjtRSMC8Ia4NDzIKngATpkTEk46dmxB5nGABIjiPJQJvlSWJE6PGQ';
const COZE_BOT_ID = '7588562297833652265';
```

### æ­¥éª¤ 2: é…ç½®ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

å¼€å‘ç¯å¢ƒä¸‹ï¼Œæµè§ˆå™¨ä¼šæœ‰ CORS é™åˆ¶ï¼Œéœ€è¦é€šè¿‡ä»£ç†è®¿é—® APIã€‚

**é…ç½®æ–‡ä»¶ï¼š** `vite.config.js`

ç¡®ä¿ä»£ç†é…ç½®å¦‚ä¸‹ï¼š

```javascript
proxy: {
  "/api/coze": {
    target: "https://api.coze.cn",
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api\/coze/, ""),
    secure: false,
  },
}
```

### æ­¥éª¤ 3: é‡å¯å¼€å‘æœåŠ¡å™¨

ä¿®æ”¹é…ç½®åï¼Œéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C æˆ– Cmd+C)
# ç„¶åé‡æ–°å¯åŠ¨
npm run dev
```

---

## ğŸ“¡ API ç«¯ç‚¹è¯´æ˜

### 1. åˆ›å»ºä¼šè¯

**ç«¯ç‚¹ï¼š** `POST /v1/conversation/create`

**åŠŸèƒ½ï¼š** åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è¯ä¼šè¯ï¼Œè¿”å›ä¼šè¯ID

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "bot_id": "ä½ çš„Bot ID"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "data": {
    "conversation_id": "ä¼šè¯ID"
  }
}
```

### 2. å‘é€æ¶ˆæ¯

**ç«¯ç‚¹ï¼š** `POST /v1/conversation/chat`

**åŠŸèƒ½ï¼š** å‘é€æ¶ˆæ¯å¹¶è·å–æœºå™¨äººå›å¤

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "conversation_id": "ä¼šè¯ID",
  "bot_id": "ä½ çš„Bot ID",
  "query": "ç”¨æˆ·æ¶ˆæ¯",
  "stream": false
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "data": {
    "messages": [
      {
        "role": "assistant",
        "content": "æœºå™¨äººå›å¤å†…å®¹"
      }
    ]
  }
}
```

---

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

### åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨

```javascript
import { chatWithBot, createConversation, sendMessage } from '../utils/cozeApi';

// æ–¹å¼1: å•æ¬¡å¯¹è¯ï¼ˆè‡ªåŠ¨åˆ›å»ºä¼šè¯ï¼‰
const handleSingleChat = async (userMessage) => {
  try {
    const { conversationId, reply } = await chatWithBot(userMessage);
    console.log('ä¼šè¯ID:', conversationId);
    console.log('æœºå™¨äººå›å¤:', reply);
    // åœ¨è¿™é‡Œå¤„ç†å›å¤å†…å®¹
  } catch (error) {
    console.error('å¯¹è¯å¤±è´¥:', error.message);
  }
};

// æ–¹å¼2: å¤šæ¬¡å¯¹è¯ï¼ˆå¤ç”¨ä¼šè¯ï¼Œä¿æŒä¸Šä¸‹æ–‡ï¼‰
const [conversationId, setConversationId] = useState(null);

const handleMultiChat = async (userMessage) => {
  try {
    // å¦‚æœæ²¡æœ‰ä¼šè¯ï¼Œå…ˆåˆ›å»º
    if (!conversationId) {
      const id = await createConversation();
      setConversationId(id);
    }
    
    // å‘é€æ¶ˆæ¯
    const reply = await sendMessage(conversationId, userMessage);
    console.log('æœºå™¨äººå›å¤:', reply);
    // åœ¨è¿™é‡Œå¤„ç†å›å¤å†…å®¹
  } catch (error) {
    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error.message);
  }
};
```

### å‡½æ•°è¯´æ˜

#### `createConversation()`
åˆ›å»ºæ–°çš„ä¼šè¯

```javascript
const conversationId = await createConversation();
```

**è¿”å›ï¼š** `Promise<string>` - ä¼šè¯ID

#### `sendMessage(conversationId, userMessage, stream?)`
å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤

**å‚æ•°ï¼š**
- `conversationId` (string): ä¼šè¯ID
- `userMessage` (string): ç”¨æˆ·æ¶ˆæ¯
- `stream` (boolean, å¯é€‰): æ˜¯å¦ä½¿ç”¨æµå¼è¿”å›ï¼Œé»˜è®¤ `false`

**è¿”å›ï¼š** `Promise<string>` - æœºå™¨äººå›å¤å†…å®¹

```javascript
const reply = await sendMessage(conversationId, 'ä½ å¥½');
```

#### `chatWithBot(userMessage)`
å®Œæ•´çš„å¯¹è¯æµç¨‹ï¼ˆåˆ›å»ºä¼šè¯ + å‘é€æ¶ˆæ¯ï¼‰

**å‚æ•°ï¼š**
- `userMessage` (string): ç”¨æˆ·æ¶ˆæ¯

**è¿”å›ï¼š** `Promise<{conversationId: string, reply: string}>`

```javascript
const { conversationId, reply } = await chatWithBot('ä½ å¥½');
```

---

## ğŸ”§ ä»£ç†é…ç½®

### å¼€å‘ç¯å¢ƒ

ä½¿ç”¨ Vite å¼€å‘æœåŠ¡å™¨çš„ä»£ç†åŠŸèƒ½ï¼Œé…ç½®æ–‡ä»¶ï¼š`vite.config.js`

```javascript
server: {
  proxy: {
    "/api/coze": {
      target: "https://api.coze.cn",
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api\/coze/, ""),
      secure: false,
    },
  },
}
```

**å·¥ä½œåŸç†ï¼š**
- å‰ç«¯è¯·æ±‚ï¼š`/api/coze/v1/conversation/create`
- ä»£ç†è½¬å‘åˆ°ï¼š`https://api.coze.cn/v1/conversation/create`
- è¿™æ ·å¯ä»¥ç»•è¿‡æµè§ˆå™¨çš„ CORS é™åˆ¶

### ç”Ÿäº§ç¯å¢ƒ

ç”Ÿäº§ç¯å¢ƒéœ€è¦æ ¹æ®å®é™…éƒ¨ç½²æƒ…å†µé…ç½®ï¼š

**é€‰é¡¹1ï¼šç»§ç»­ä½¿ç”¨ä»£ç†**
- åœ¨æœåŠ¡å™¨ç«¯ï¼ˆå¦‚ Nginxï¼‰é…ç½®ä»£ç†
- é…ç½®æ–¹å¼ç±»ä¼¼å¼€å‘ç¯å¢ƒçš„ä»£ç†

**é€‰é¡¹2ï¼šç›´æ¥è°ƒç”¨ API**
- å¦‚æœæœåŠ¡å™¨å…è®¸ CORSï¼Œå¯ä»¥ä¿®æ”¹ `src/utils/cozeApi.js` ä¸­çš„ `API_BASE_URL`ï¼š
```javascript
const API_BASE_URL = 'https://api.coze.cn'; // ç›´æ¥ä½¿ç”¨ API åœ°å€
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: API Token æ— æ•ˆæˆ–å·²è¿‡æœŸ

**é”™è¯¯ä¿¡æ¯ï¼š** `API Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·æ£€æŸ¥API Tokené…ç½®` (HTTP 401)

**è§£å†³æ–¹æ³•ï¼š**
1. ç™»å½• Coze å¼€æ”¾å¹³å°
2. æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸï¼ˆæœ€é•¿æœ‰æ•ˆæœŸ 30 å¤©ï¼‰
3. é‡æ–°ç”Ÿæˆæ–°çš„ Token
4. æ›´æ–° `src/utils/cozeApi.js` ä¸­çš„ `COZE_API_TOKEN`

### Q2: åˆ›å»ºä¼šè¯æˆåŠŸä½†æœªè¿”å›ä¼šè¯ID

**é”™è¯¯ä¿¡æ¯ï¼š** `åˆ›å»ºä¼šè¯æˆåŠŸä½†æœªè¿”å›ä¼šè¯ID`

**è§£å†³æ–¹æ³•ï¼š**
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„ `åˆ›å»ºä¼šè¯å®Œæ•´å“åº”` æ—¥å¿—
2. æ£€æŸ¥å“åº”æ•°æ®ç»“æ„
3. å¦‚æœæ˜¯å­—æ®µè·¯å¾„é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ä»£ç ä¸­çš„å­—æ®µæå–é€»è¾‘

### Q3: API ç«¯ç‚¹ä¸å­˜åœ¨ (404)

**é”™è¯¯ä¿¡æ¯ï¼š** `å‘é€æ¶ˆæ¯å¤±è´¥ (HTTP 404)`

**å¯èƒ½åŸå› ï¼š**
1. API è·¯å¾„ä¸æ­£ç¡®
2. ä»£ç†é…ç½®æœ‰é—®é¢˜
3. API ç«¯ç‚¹å·²å˜æ›´

**è§£å†³æ–¹æ³•ï¼š**
1. æŸ¥çœ‹æ§åˆ¶å°çš„ `å‘é€æ¶ˆæ¯ - è¯·æ±‚URL` æ—¥å¿—
2. æ£€æŸ¥ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹ Coze API å®˜æ–¹æ–‡æ¡£ç¡®è®¤æ­£ç¡®çš„ç«¯ç‚¹è·¯å¾„

### Q4: CORS è·¨åŸŸé”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå¯èƒ½æ˜¯CORSé—®é¢˜æˆ–ç½‘ç»œè¿æ¥é—®é¢˜`

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®ä¿ `vite.config.js` ä¸­å·²é…ç½®ä»£ç†
2. ç¡®ä¿ä½¿ç”¨ `/api/coze` ä½œä¸º API åŸºç¡€è·¯å¾„ï¼ˆä¸æ˜¯ `https://api.coze.cn`ï¼‰
3. é‡å¯å¼€å‘æœåŠ¡å™¨

### Q5: æ— æ³•æå–å›å¤å†…å®¹

**é”™è¯¯ä¿¡æ¯ï¼š** `APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæ— æ³•æå–å›å¤å†…å®¹`

**è§£å†³æ–¹æ³•ï¼š**
1. æŸ¥çœ‹æ§åˆ¶å°çš„ `å‘é€æ¶ˆæ¯å®Œæ•´å“åº”` æ—¥å¿—
2. æ£€æŸ¥ API å“åº”çš„å®é™…æ•°æ®ç»“æ„
3. å¯èƒ½éœ€è¦æ ¹æ®å®é™…å“åº”æ ¼å¼è°ƒæ•´ä»£ç 

---

## ğŸ” é”™è¯¯æ’æŸ¥

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

ä»£ç ä¸­å·²ç»æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

1. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°** (F12)
2. **åˆ‡æ¢åˆ° Console æ ‡ç­¾**
3. **æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š**

```
åˆ›å»ºä¼šè¯ - è¯·æ±‚URL: /api/coze/v1/conversation/create
åˆ›å»ºä¼šè¯å®Œæ•´å“åº”: {...}
å‘é€æ¶ˆæ¯ - è¯·æ±‚URL: /api/coze/v1/conversation/chat
å‘é€æ¶ˆæ¯å®Œæ•´å“åº”: {...}
```

### æ£€æŸ¥æ¸…å•

é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] API Token æ˜¯å¦æ­£ç¡®å¡«å†™
- [ ] Bot ID æ˜¯å¦æ­£ç¡®å¡«å†™
- [ ] å¼€å‘æœåŠ¡å™¨æ˜¯å¦å·²é‡å¯
- [ ] ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆ`vite.config.js`ï¼‰
- [ ] ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- [ ] API Token æ˜¯å¦å·²è¿‡æœŸ

### æµ‹è¯• API é…ç½®

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

```javascript
import { createConversation } from '../utils/cozeApi';

// æµ‹è¯•åˆ›å»ºä¼šè¯
createConversation()
  .then(id => {
    console.log('âœ… é…ç½®æ­£ç¡®ï¼Œä¼šè¯ID:', id);
  })
  .catch(error => {
    console.error('âŒ é…ç½®æœ‰è¯¯:', error.message);
  });
```

---

## ğŸ“š ç›¸å…³èµ„æº

- **Coze å¼€æ”¾å¹³å°ï¼š** https://www.coze.cn/open
- **API æ–‡æ¡£ï¼š** https://www.coze.cn/open/apidocs
- **ä»£ç æ–‡ä»¶ä½ç½®ï¼š** `src/utils/cozeApi.js`
- **é…ç½®æ–‡ä»¶ä½ç½®ï¼š** `vite.config.js`

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºç¡€ API è°ƒç”¨åŠŸèƒ½
- âœ… ä¼šè¯ç®¡ç†
- âœ… æ¶ˆæ¯å‘é€å’Œå›å¤æå–
- âœ… ä»£ç†é…ç½®æ”¯æŒ
- âœ… è¯¦ç»†é”™è¯¯å¤„ç†å’Œæ—¥å¿—

---

## ğŸ’¬ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„ **å¸¸è§é—®é¢˜** å’Œ **é”™è¯¯æ’æŸ¥** ç« èŠ‚
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—
3. å‚è€ƒ Coze API å®˜æ–¹æ–‡æ¡£
4. æ£€æŸ¥ä»£ç ä¸­çš„æ³¨é‡Šå’Œç¤ºä¾‹

---

**æœ€åæ›´æ–°ï¼š** 2024å¹´








